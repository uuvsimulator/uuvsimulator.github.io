

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Making a simple seabed world model &mdash; UUV Simulator 0.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="UUV Simulator 0.2 documentation" href="../index.html"/>
        <link rel="up" title="Tutorials" href="index.html"/>
        <link rel="next" title="Applying disturbances during the simulation" href="disturbances.html"/>
        <link rel="prev" title="Creating a new custom dynamic positioning controller" href="creating_new_dp_controller.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> UUV Simulator
          

          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="create_new_vehicle.html">Creating a new underwater vehicle model</a></li>
<li class="toctree-l2"><a class="reference internal" href="config_thruster_manager.html">Configuring the thruster manager for a new vehicle</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating_new_dp_controller.html">Creating a new custom dynamic positioning controller</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Making a simple seabed world model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-mesh-file">Creating the mesh file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-gazebo-seabed-model">Creating the Gazebo seabed model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-new-gazebo-world">Creating a new Gazebo world</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="disturbances.html">Applying disturbances during the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="plume_simulation.html">Starting a plume simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_wrapper.html">How to use the wrapper class for repetitive simulation runs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../vehicles.html">Vehicles available</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">F.A.Q.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">UUV Simulator</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>Making a simple seabed world model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/seabed_world.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="making-a-simple-seabed-world-model">
<span id="seabed-world"></span><h1>Making a simple seabed world model<a class="headerlink" href="#making-a-simple-seabed-world-model" title="Permalink to this headline">¶</a></h1>
<p>For the following tutorial, all the files can also be found in the
<a class="reference external" href="https://github.com/uuvsimulator/uuv_simulator/tree/master/uuv_tutorials/uuv_tutorial_seabed_world">uuv_tutorial_seabed_world</a> package.</p>
<p>The seabed can be critical in simulation scenarios where the objective is, for example, to use UUVs for bathymetric mapping or just to make
the scenario look more realistic.</p>
<p>Gazebo already has a feature to generate heightmaps from grayscale images (see the video below). This is a very quick way to
setup a heightmap, but it can happen that its complexity might make the simulation run slower when trying to interact with it.</p>
<iframe src="https://player.vimeo.com/video/58409707" width="640" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
<p><a href="https://vimeo.com/58409707">Gazebo: Heightmap Tutorial</a> from <a href="https://vimeo.com/osrfoundation">OSRF</a> on <a href="https://vimeo.com">Vimeo</a>.</p><p>Another option is to take an existent point cloud of a seabed and convert it into a mesh that can be imported in Gazebo like any other model.</p>
<div class="section" id="creating-the-mesh-file">
<h2>Creating the mesh file<a class="headerlink" href="#creating-the-mesh-file" title="Permalink to this headline">¶</a></h2>
<p>Measurement data can be sparse and have outliers that need to be removed before generating the mesh. The script below is an example on how the measurement
data can be interpolated into a grid and later converted into an STL file. For this example, we will use the test surface available in the <strong>matplotlib</strong>
package, but you should replace it with your own point cloud data. You will also need the packages <strong>numpy</strong>, <strong>scipy</strong> and <strong>numpy-stl</strong>.</p>
<p>To install the necessary packages, you can use <strong>pip</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">pip</span>
<span class="n">sudo</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">numpy</span> <span class="n">scipy</span> <span class="n">matplotlib</span> <span class="n">numpy</span><span class="o">-</span><span class="n">stl</span>
</pre></div>
</div>
<p>To generate the mesh, change the code below to your needs</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage</span> <span class="kn">as</span> <span class="nn">ndimage</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter</span>
<span class="kn">from</span> <span class="nn">scipy.misc</span> <span class="kn">import</span> <span class="n">imsave</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">stl</span> <span class="kn">import</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">Mode</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="kn">as</span> <span class="nn">mtri</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.axes3d</span> <span class="kn">import</span> <span class="n">get_test_data</span>

<span class="c1"># Generating the surface</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">(</span><span class="n">delta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="c1"># Scale the surface for this example</span>
<span class="n">z</span> <span class="o">*=</span> <span class="mf">0.05</span>
<span class="c1"># Remember that Gazebo uses ENU (east-north-up) convention, so underwater</span>
<span class="c1"># the Z coordinate will be negative</span>
<span class="n">z</span> <span class="o">-=</span> <span class="mi">3</span>
<span class="c1"># Note: Gazebo will import your mesh in meters. </span>

<span class="c1"># Point clouds usually don&#39;t come in nice grids, so let&#39;s make it a (N, 3)</span>
<span class="c1"># matrix just to show how it can be done. If you have outliers or noise, you should</span>
<span class="c1"># treat those values now.</span>
<span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">xyz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># Generate a grid for the X and Y coordinates, change the number of points</span>
<span class="c1"># to your needs. Large grids can generate files that are too big for Gazebo, so</span>
<span class="c1"># be careful when choosing the resolution of your grid.</span>
<span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">300</span><span class="p">),</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">200</span><span class="p">))</span>

<span class="c1"># Interpolate over the point cloud for our grid</span>
<span class="n">z_grid</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span><span class="p">),</span>
                  <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

<span class="c1"># Option to treat noise</span>
<span class="c1">#z_grid = gaussian_filter(z_grid, sigma=1)</span>

<span class="c1"># Show the resulting heightmap as an image</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">z_grid</span><span class="p">)</span>

<span class="c1"># Flatten our interpolated data for triangulation</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">x_grid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">output</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">output</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">output</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># Triangulation of the interpolated data</span>
<span class="n">tri</span> <span class="o">=</span> <span class="n">mtri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">output</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">output</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># Show the resulting surface</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span><span class="n">tri</span><span class="p">,</span> <span class="n">output</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">CMRmap</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

<span class="c1"># Create the mesh object</span>
<span class="n">seabed_mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">Mesh</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

<span class="c1"># Set the vectors</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">seabed_mesh</span><span class="o">.</span><span class="n">vectors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>

<span class="c1"># Store the seabed as a STL file</span>
<span class="n">seabed_mesh</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;seabed.stl&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Below you can see the resulting heightmap as an image</p>
<img alt="../_images/seabed_image.png" src="../_images/seabed_image.png" />
<p>and the triangulated grid used for the creation of the seabed</p>
<img alt="../_images/seabed_tri.png" src="../_images/seabed_tri.png" />
<p>Now a <strong>seabed.stl</strong> data has been created or you can download it <a class="reference external" href="https://github.com/uuvsimulator/uuv_simulator/blob/master/uuv_tutorials/uuv_tutorial_seabed_world/models/tutorial_seabed/meshes/seabed.stl">here</a>.
You can open it using <a class="reference external" href="http://meshlab.sourceforge.net/">MeshLab</a> or <a class="reference external" href="https://www.blender.org/">Blender</a>. Here we will use Blender to show
the surface. You can also use Blender to edit the mesh, if necessary.</p>
<img alt="../_images/seabed_blender.png" src="../_images/seabed_blender.png" />
<p>Even though the surface is ready, if you import it in Gazebo as it is you might
not be able to have contact forces if you hit the seabed with your robot. One
way to solve it is to import the STL in Blender using the STL importer tool</p>
<img alt="../_images/import_stl_blender.png" src="../_images/import_stl_blender.png" />
<p>and once the surface is uploaded, go to the <strong>Modifiers</strong> section of the right
panel as follows</p>
<img alt="../_images/modifier_blender.png" src="../_images/modifier_blender.png" />
<p>and choose the option <strong>Solidify</strong> in the <strong>Add modifier</strong> popup menu.</p>
<img alt="../_images/solidify.png" src="../_images/solidify.png" />
<p>Enter a value for the surface’s thickness as shown below and click on the button
<strong>Apply</strong>.</p>
<img alt="../_images/thickness.png" src="../_images/thickness.png" />
<p>You can now export you surface again using the STL exporter tool. Now you need
to create a <a class="reference external" href="http://sdformat.org/">SDF</a> model description of your seabed to load it in Gazebo.</p>
</div>
<div class="section" id="creating-the-gazebo-seabed-model">
<h2>Creating the Gazebo seabed model<a class="headerlink" href="#creating-the-gazebo-seabed-model" title="Permalink to this headline">¶</a></h2>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">For the further steps, be sure to have followed the installation
instructions that can be found in this page: <a class="reference internal" href="../installation.html#installation"><span class="std std-ref">Installation</span></a>.</p>
</div>
<p>To be able to load your seabed mesh in Gazebo, you need a SDF model describing
it. Starting from the folder structure, let’s create a new catkin package for
this world description. The folder structure below is only a suggestion based
on the structure used in this package.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span>
<span class="n">catkin_create_pkg</span> <span class="n">uuv_tutorial_seabed_world</span>
<span class="n">cd</span> <span class="n">uuv_tutorial_seabed_world</span>
<span class="n">mkdir</span> <span class="n">models</span> <span class="n">worlds</span> <span class="n">launch</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">models</span><span class="o">/</span><span class="n">tutorial_seabed</span><span class="o">/</span><span class="n">meshes</span>
</pre></div>
</div>
<p>Let’s create the files for our seabed model.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">uuv_tutorial_seabed_world</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">tutorial_seabed</span>
<span class="n">touch</span> <span class="n">model</span><span class="o">.</span><span class="n">config</span> <span class="n">model</span><span class="o">.</span><span class="n">sdf</span>
</pre></div>
</div>
<p>Now copy the <strong>seabed.stl</strong> file into the folder
<strong>uuv_tutorial_seabed_world/models/tutorial_seabed/meshes</strong>.</p>
<p>For the Gazebo seabed model, you will need to create the following files in
your <strong>uuv_tutorial_seabed_world/models/tutorial_seabed</strong> folder. The materials
used below come from UUV simulator’s <a class="reference external" href="https://github.com/uuvsimulator/uuv_simulator/tree/master/uuv_descriptions/Media/materials">materials description</a>.
You can replace them for other textures. You can change them to, for example,
the <a class="reference external" href="https://bitbucket.org/osrf/gazebo/src/7d7c37d66d00f1e5e3d96a90734bc61f1f75d8eb/media/materials/scripts/gazebo.material?at=default&amp;fileviewer=file-view-default">default materials provided by Gazebo</a>.</p>
<ul class="simple">
<li><strong>model.config</strong></li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="c">&lt;!-- Copyright (c) 2016 The UUV Simulator Authors.</span>
<span class="c">     All rights reserved.</span>

<span class="c">     Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c">     you may not use this file except in compliance with the License.</span>
<span class="c">     You may obtain a copy of the License at</span>

<span class="c">       http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c">     Unless required by applicable law or agreed to in writing, software</span>
<span class="c">     distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c">     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c">     See the License for the specific language governing permissions and</span>
<span class="c">     limitations under the License.</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;model&gt;</span>
  <span class="nt">&lt;name&gt;</span>Tutorial - Seabed<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;sdf</span> <span class="na">version=</span><span class="s">&quot;1.5&quot;</span><span class="nt">&gt;</span>model.sdf<span class="nt">&lt;/sdf&gt;</span>

  <span class="nt">&lt;author&gt;</span>
    <span class="nt">&lt;name&gt;</span>John Doe<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;email&gt;</span>john.doe@email.com<span class="nt">&lt;/email&gt;</span>
  <span class="nt">&lt;/author&gt;</span>

  <span class="nt">&lt;description&gt;</span>
    A nice seabed.
  <span class="nt">&lt;/description&gt;</span>

<span class="nt">&lt;/model&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>model.sdf</strong></li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>
<span class="c">&lt;!-- Copyright (c) 2016 The UUV Simulator Authors.</span>
<span class="c">     All rights reserved.</span>

<span class="c">     Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c">     you may not use this file except in compliance with the License.</span>
<span class="c">     You may obtain a copy of the License at</span>

<span class="c">       http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c">     Unless required by applicable law or agreed to in writing, software</span>
<span class="c">     distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c">     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c">     See the License for the specific language governing permissions and</span>
<span class="c">     limitations under the License.</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;sdf</span> <span class="na">version=</span><span class="s">&quot;1.5&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;model</span> <span class="na">name=</span><span class="s">&quot;seabed&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;static&gt;</span>true<span class="nt">&lt;/static&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&quot;seabed_link&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;visual</span> <span class="na">name=</span><span class="s">&quot;surface&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;cast_shadows&gt;</span>false<span class="nt">&lt;/cast_shadows&gt;</span>
    <span class="nt">&lt;pose&gt;</span>0 0 0 0 0 0<span class="nt">&lt;/pose&gt;</span>
    <span class="nt">&lt;geometry&gt;</span>
      <span class="nt">&lt;box&gt;</span>
        <span class="nt">&lt;size&gt;</span>60 60 .1<span class="nt">&lt;/size&gt;</span>
      <span class="nt">&lt;/box&gt;</span>
    <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;material&gt;</span>
      <span class="nt">&lt;script&gt;</span>
        <span class="nt">&lt;uri&gt;</span>file://Media/materials/scripts/water.material<span class="nt">&lt;/uri&gt;</span>
        <span class="nt">&lt;name&gt;</span>UUVSimulator/StaticWater<span class="nt">&lt;/name&gt;</span>
      <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/material&gt;</span>
  <span class="nt">&lt;/visual&gt;</span>

  <span class="nt">&lt;visual</span> <span class="na">name=</span><span class="s">&quot;seafloor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;pose&gt;</span>0 0 0 0 0 0<span class="nt">&lt;/pose&gt;</span>
    <span class="nt">&lt;geometry&gt;</span>
      <span class="nt">&lt;mesh&gt;&lt;uri&gt;</span>model://tutorial_seabed/meshes/seabed.stl<span class="nt">&lt;/uri&gt;&lt;scale&gt;</span>1 1 1<span class="nt">&lt;/scale&gt;&lt;/mesh&gt;</span>
    <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;material&gt;</span>
      <span class="nt">&lt;script&gt;</span>
        <span class="nt">&lt;uri&gt;</span>file://Media/materials/scripts/sand.material<span class="nt">&lt;/uri&gt;</span>
        <span class="nt">&lt;name&gt;</span>UUVSimulator/SandAndStones<span class="nt">&lt;/name&gt;</span>
      <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/material&gt;</span>
  <span class="nt">&lt;/visual&gt;</span>

  <span class="nt">&lt;collision</span> <span class="na">name=</span><span class="s">&quot;seafloor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;pose&gt;</span>0 0 0 0 0 0<span class="nt">&lt;/pose&gt;</span>
    <span class="nt">&lt;geometry&gt;</span>
      <span class="nt">&lt;mesh&gt;&lt;uri&gt;</span>model://tutorial_seabed/meshes/seabed.stl<span class="nt">&lt;/uri&gt;&lt;scale&gt;</span>1 1 1<span class="nt">&lt;/scale&gt;&lt;/mesh&gt;</span>
    <span class="nt">&lt;/geometry&gt;</span>
  <span class="nt">&lt;/collision&gt;</span>

  <span class="nt">&lt;/link&gt;</span>
<span class="nt">&lt;/model&gt;</span>
<span class="nt">&lt;/sdf&gt;</span>
</pre></div>
</div>
<p>Now you can configure your <strong>catkin package</strong> so that the model can be listed in
Gazebo as a model. For that you’ll have to configure the <strong>package.xml</strong> and
<strong>CMakeLists.txt</strong> files as in the examples below.</p>
<ul class="simple">
<li><strong>CMakeLists.txt</strong></li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span>cmake_minimum_required(VERSION 2.8.3)
project(uuv_tutorial_seabed_world)

find_package(catkin REQUIRED)
find_package(gazebo REQUIRED) # this is only required to get gazebo&#39;s directories

catkin_package()

install(DIRECTORY launch worlds models
        DESTINATION ${CATKIN_PACKAGE_SHARE_DESTINATION}
        PATTERN &quot;*~&quot; EXCLUDE)
</pre></div>
</div>
<ul class="simple">
<li><strong>package.xml</strong></li>
</ul>
<p>For this file, be sure to have the following lines:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span>  <span class="nt">&lt;buildtool_depend&gt;</span>catkin<span class="nt">&lt;/buildtool_depend&gt;</span>

  <span class="nt">&lt;run_depend&gt;</span>gazebo_ros<span class="nt">&lt;/run_depend&gt;</span>

  <span class="nt">&lt;export&gt;</span>
    <span class="nt">&lt;gazebo_ros</span> <span class="na">gazebo_media_path=</span><span class="s">&quot;${prefix}&quot;</span>
                <span class="na">gazebo_model_path=</span><span class="s">&quot;${prefix}/models&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/export&gt;</span>
</pre></div>
</div>
<p>You can now build your workspace as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">catkin_ws</span>
<span class="n">catkin_make</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">catkin_ws</span>
<span class="n">catkin</span> <span class="n">build</span>
</pre></div>
</div>
<p>if you are using <strong>catkin tools</strong>.</p>
<p>Now, if you open Gazebo using</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">roslaunch</span> <span class="n">gazebo_ros</span> <span class="n">empty_world</span><span class="o">.</span><span class="n">launch</span>
</pre></div>
</div>
<p>and delete the <strong>ground_plane</strong> model under the <strong>Models</strong> list, and then
select the <strong>Tutorial - Seabed</strong> model from the list at the <strong>Insert</strong> tab,
you will be able to see the following screen</p>
<img alt="../_images/gazebo_seabed.png" src="../_images/gazebo_seabed.png" />
</div>
<div class="section" id="creating-a-new-gazebo-world">
<h2>Creating a new Gazebo world<a class="headerlink" href="#creating-a-new-gazebo-world" title="Permalink to this headline">¶</a></h2>
<p>Now that the model is done, you can create a Gazebo world to load your scenario
with the seabed model. Create a new world file as follows</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">roscd</span> <span class="n">uuv_tutorial_seabed_world</span><span class="o">/</span><span class="n">worlds</span>
<span class="n">touch</span> <span class="n">example_underwater</span><span class="o">.</span><span class="n">world</span>
</pre></div>
</div>
<p>and a <strong>launch</strong> file to start it</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">roscd</span> <span class="n">uuv_tutorial_seabed_world</span><span class="o">/</span><span class="n">launch</span>
<span class="n">touch</span> <span class="n">tutorial_seabed_world</span><span class="o">.</span><span class="n">launch</span>
</pre></div>
</div>
<p>The contents of both files can be seen below</p>
<ul class="simple">
<li><strong>example_underwater.world</strong></li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>
<span class="c">&lt;!-- Copyright (c) 2016 The UUV Simulator Authors.</span>
<span class="c">     All rights reserved.</span>

<span class="c">     Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c">     you may not use this file except in compliance with the License.</span>
<span class="c">     You may obtain a copy of the License at</span>

<span class="c">       http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c">     Unless required by applicable law or agreed to in writing, software</span>
<span class="c">     distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c">     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c">     See the License for the specific language governing permissions and</span>
<span class="c">     limitations under the License.</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;sdf</span> <span class="na">version=</span><span class="s">&quot;1.5&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;world</span> <span class="na">name=</span><span class="s">&quot;example_underwater&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;physics</span> <span class="na">name=</span><span class="s">&quot;default_physics&quot;</span> <span class="na">default=</span><span class="s">&quot;true&quot;</span> <span class="na">type=</span><span class="s">&quot;ode&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;max_step_size&gt;</span>0.002<span class="nt">&lt;/max_step_size&gt;</span>
      <span class="nt">&lt;real_time_factor&gt;</span>1<span class="nt">&lt;/real_time_factor&gt;</span>
      <span class="nt">&lt;real_time_update_rate&gt;</span>500<span class="nt">&lt;/real_time_update_rate&gt;</span>
      <span class="nt">&lt;ode&gt;</span>
        <span class="nt">&lt;solver&gt;</span>
          <span class="nt">&lt;type&gt;</span>quick<span class="nt">&lt;/type&gt;</span>
          <span class="nt">&lt;iters&gt;</span>50<span class="nt">&lt;/iters&gt;</span>
          <span class="nt">&lt;sor&gt;</span>0.5<span class="nt">&lt;/sor&gt;</span>
        <span class="nt">&lt;/solver&gt;</span>
      <span class="nt">&lt;/ode&gt;</span>
    <span class="nt">&lt;/physics&gt;</span>
    <span class="nt">&lt;scene&gt;</span>
      <span class="nt">&lt;ambient&gt;</span>0.01 0.01 0.01 1.0<span class="nt">&lt;/ambient&gt;</span>
      <span class="nt">&lt;sky&gt;</span>
        <span class="nt">&lt;clouds&gt;</span>
          <span class="nt">&lt;speed&gt;</span>12<span class="nt">&lt;/speed&gt;</span>
        <span class="nt">&lt;/clouds&gt;</span>
      <span class="nt">&lt;/sky&gt;</span>
      <span class="nt">&lt;shadows&gt;</span>1<span class="nt">&lt;/shadows&gt;</span>
    <span class="nt">&lt;/scene&gt;</span>

    <span class="c">&lt;!-- Global light source --&gt;</span>
    <span class="nt">&lt;include&gt;</span>
      <span class="nt">&lt;uri&gt;</span>model://sun<span class="nt">&lt;/uri&gt;</span>
    <span class="nt">&lt;/include&gt;</span>

    <span class="nt">&lt;include&gt;</span>
      <span class="nt">&lt;uri&gt;</span>model://tutorial_seabed<span class="nt">&lt;/uri&gt;</span>
      <span class="nt">&lt;pose&gt;</span>0 0 0 0 0 0<span class="nt">&lt;/pose&gt;</span>
    <span class="nt">&lt;/include&gt;</span>

    <span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">&quot;underwater_current_plugin&quot;</span> <span class="na">filename=</span><span class="s">&quot;libuuv_underwater_current_ros_plugin.so&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;namespace&gt;</span>hydrodynamics<span class="nt">&lt;/namespace&gt;</span>
      <span class="nt">&lt;constant_current&gt;</span>
        <span class="nt">&lt;topic&gt;</span>current_velocity<span class="nt">&lt;/topic&gt;</span>
        <span class="nt">&lt;velocity&gt;</span>
          <span class="nt">&lt;mean&gt;</span>0<span class="nt">&lt;/mean&gt;</span>
          <span class="nt">&lt;min&gt;</span>0<span class="nt">&lt;/min&gt;</span>
          <span class="nt">&lt;max&gt;</span>5<span class="nt">&lt;/max&gt;</span>
          <span class="nt">&lt;mu&gt;</span>0.0<span class="nt">&lt;/mu&gt;</span>
          <span class="nt">&lt;noiseAmp&gt;</span>0.0<span class="nt">&lt;/noiseAmp&gt;</span>
        <span class="nt">&lt;/velocity&gt;</span>

        <span class="nt">&lt;horizontal_angle&gt;</span>
          <span class="nt">&lt;mean&gt;</span>0<span class="nt">&lt;/mean&gt;</span>
          <span class="nt">&lt;min&gt;</span>-3.141592653589793238<span class="nt">&lt;/min&gt;</span>
          <span class="nt">&lt;max&gt;</span>3.141592653589793238<span class="nt">&lt;/max&gt;</span>
          <span class="nt">&lt;mu&gt;</span>0.0<span class="nt">&lt;/mu&gt;</span>
          <span class="nt">&lt;noiseAmp&gt;</span>0.0<span class="nt">&lt;/noiseAmp&gt;</span>
        <span class="nt">&lt;/horizontal_angle&gt;</span>

        <span class="nt">&lt;vertical_angle&gt;</span>
          <span class="nt">&lt;mean&gt;</span>0<span class="nt">&lt;/mean&gt;</span>
          <span class="nt">&lt;min&gt;</span>-3.141592653589793238<span class="nt">&lt;/min&gt;</span>
          <span class="nt">&lt;max&gt;</span>3.141592653589793238<span class="nt">&lt;/max&gt;</span>
          <span class="nt">&lt;mu&gt;</span>0.0<span class="nt">&lt;/mu&gt;</span>
          <span class="nt">&lt;noiseAmp&gt;</span>0.0<span class="nt">&lt;/noiseAmp&gt;</span>
        <span class="nt">&lt;/vertical_angle&gt;</span>
      <span class="nt">&lt;/constant_current&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span>

    <span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">&quot;sc_interface&quot;</span> <span class="na">filename=</span><span class="s">&quot;libuuv_sc_ros_interface_plugin.so&quot;</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;/world&gt;</span>
<span class="nt">&lt;/sdf&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>tutorial_seabed_world.launch</strong></li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;gui&quot;</span> <span class="na">default=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;paused&quot;</span> <span class="na">default=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!-- We resume the logic in empty_world.launch, changing only the name of the world to be launched --&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">&quot;$(find gazebo_ros)/launch/empty_world.launch&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- Edit the name of the world file (example_underwater.world) when using this template --&gt;</span>
        <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;world_name&quot;</span> <span class="na">value=</span><span class="s">&quot;worlds/example_underwater.world&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;paused&quot;</span> <span class="na">value=</span><span class="s">&quot;$(arg paused)&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;use_sim_time&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;gui&quot;</span> <span class="na">value=</span><span class="s">&quot;$(arg gui)&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;headless&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;debug&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;verbose&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/include&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<p>Now you can launch your world using</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">roslaunch</span> <span class="n">uuv_tutorial_seabed_world</span> <span class="n">tutorial_seabed_world</span><span class="o">.</span><span class="n">launch</span>
</pre></div>
</div>
<p>and the result on the screen should be</p>
<img alt="../_images/gazebo_seabed_world.png" src="../_images/gazebo_seabed_world.png" />
<p>Done! Now the custom seabed can be used for your simulation.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="disturbances.html" class="btn btn-neutral float-right" title="Applying disturbances during the simulation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="creating_new_dp_controller.html" class="btn btn-neutral" title="Creating a new custom dynamic positioning controller" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, UUV Simulator Authors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>